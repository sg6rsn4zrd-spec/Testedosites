<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LISBOA PRO MASTER v2.5</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #0a0e17; --card: #161b28; --primary: #2a5ee8;
            --accent: #00d2ff; --success: #00f298; --danger: #ff4b5c;
            --text: #e1e8f0;
        }
        
        body {
            margin: 0; font-family: 'Inter', sans-serif;
            background: var(--bg); color: var(--text);
            padding-bottom: 80px;
        }

        .glass {
            background: rgba(22, 27, 40, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 24px;
        }

        .header {
            background: var(--card); padding: 15px; text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: sticky; top: 0; z-index: 100;
        }

        .container { padding: 15px; max-width: 500px; margin: auto; }

        .balance-card { padding: 25px; text-align: center; margin-bottom: 20px; }
        .balance-val { font-size: 2.5rem; font-weight: 800; color: var(--success); margin: 10px 0; }

        /* Menu Grid - 4 colunas */
        .menu-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 25px; }
        .menu-item {
            background: var(--card); padding: 12px 5px; border-radius: 16px;
            text-align: center; cursor: pointer; transition: 0.3s;
            border: 1px solid rgba(255,255,255,0.05);
            position: relative;
        }
        .menu-item:active { transform: scale(0.95); background: var(--primary); }
        .menu-item i { font-size: 1.2rem; color: var(--accent); margin-bottom: 6px; display:block; }
        .menu-item span { font-size: 0.55rem; font-weight:700; text-transform: uppercase; }

        .section { display:none; animation: fadeIn 0.4s ease; }
        .active { display:block; }
        @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

        input, select, textarea {
            background: #0f141e; border: 1px solid #2d364a;
            color: white; padding: 14px; border-radius: 12px;
            width: 100%; box-sizing: border-box; margin: 8px 0; font-size: 14px;
        }

        button {
            background: var(--primary); color: white; padding: 15px;
            border-radius: 12px; border: none; font-weight: 700;
            width: 100%; cursor: pointer; margin-top: 10px;
        }

        .btn-success { background: var(--success); color: #0a0e17; }
        .btn-danger { background: var(--danger); }

        .list-item {
            background: rgba(255,255,255,0.03); padding: 12px;
            border-radius: 14px; margin-bottom: 8px;
            display: flex; justify-content: space-between; align-items: center;
            border-left: 4px solid var(--primary); font-size: 14px;
        }

        .badge { background: var(--danger); color:white; border-radius:50px; padding:2px 6px; font-size:9px; position:absolute; top:-3px; right:-3px; }
    </style>
</head>
<body>

<div class="header">
    <strong style="letter-spacing: 2px; color: var(--accent)">LISBOA PRO MASTER</strong>
</div>

<div id="loginPage" class="container">
    <div class="balance-card glass">
        <i class="fas fa-shield-alt" style="font-size:2rem; color:var(--accent); margin-bottom:10px"></i>
        <h3>ACESSO RESTRITO</h3>
        <input id="pass" type="password" placeholder="Senha Administrativa">
        <button onclick="login()">ENTRAR</button>
    </div>
</div>

<div id="mainPage" class="container" style="display:none">
    
    <div class="balance-card glass">
        <select id="filtroMes" onchange="render()" style="width: auto; padding: 5px; font-size: 12px; background: transparent; border: none; color: var(--accent);">
            <option value="all">TODOS OS MESES</option>
            <option value="0">JANEIRO</option><option value="1">FEVEREIRO</option>
            <option value="2">MAR√áO</option><option value="3">ABRIL</option>
            <option value="4">MAIO</option><option value="5">JUNHO</option>
            <option value="6">JULHO</option><option value="7">AGOSTO</option>
            <option value="8">SETEMBRO</option><option value="9">OUTUBRO</option>
            <option value="10">NOVEMBRO</option><option value="11">DEZEMBRO</option>
        </select>
        <div class="balance-val" id="val-lucro">R$ 0,00</div>
        <div style="display:flex; justify-content:space-around; font-size:10px; opacity:0.8">
            <span>M√ÉO DE OBRA: <b id="val-mao">R$ 0</b></span>
            <span>CONTAS: <b id="val-contas" style="color:var(--danger)">R$ 0</b></span>
        </div>
    </div>

    <div class="menu-grid">
        <div class="menu-item" onclick="nav('sec-dash')"><i class="fas fa-chart-line"></i><span>Dash</span></div>
        <div class="menu-item" onclick="nav('sec-serv')"><i class="fas fa-plus-circle"></i><span>Novo</span></div>
        <div class="menu-item" onclick="nav('sec-contas')"><i class="fas fa-receipt"></i><span>Contas</span></div>
        <div class="menu-item" onclick="nav('sec-hist')"><i class="fas fa-search"></i><span>Busca</span></div>
        <div class="menu-item" onclick="nav('sec-oleo')">
            <i class="fas fa-oil-can"></i><span>√ìleo</span>
            <span id="notif-oleo" class="badge" style="display:none">0</span>
        </div>
        <div class="menu-item" onclick="nav('sec-estoque')"><i class="fas fa-box"></i><span>Estoque</span></div>
        <div class="menu-item" onclick="nav('sec-tabela')"><i class="fas fa-tags"></i><span>Tabela</span></div>
        <div class="menu-item" onclick="nav('sec-taxa')"><i class="fas fa-credit-card"></i><span>Taxas</span></div>
        <div class="menu-item" onclick="nav('sec-agenda')"><i class="fas fa-calendar-alt"></i><span>Agenda</span></div>
        <div class="menu-item" onclick="nav('sec-compras')"><i class="fas fa-shopping-cart"></i><span>Compras</span></div>
        <div class="menu-item" onclick="nav('sec-check')"><i class="fas fa-check-double"></i><span>Check</span></div>
        <div class="menu-item" onclick="nav('sec-ia')"><i class="fas fa-brain"></i><span>I.A</span></div>
    </div>

    <div id="sec-dash" class="section active">
        <canvas id="chartFin" height="200"></canvas>
        <button class="btn-success" onclick="gerarPDF()">GERAR PDF</button>
        <button onclick="exportCSV()">EXPORTAR EXCEL (CSV)</button>
    </div>

    <div id="sec-serv" class="section">
        <h3>üîß Novo Servi√ßo</h3>
        <input id="sNome" placeholder="Cliente">
        <input id="sPlaca" placeholder="Placa">
        <input id="sCel" placeholder="WhatsApp">
        <input id="sMao" type="number" placeholder="Sua M√£o de Obra">
        <input id="sPec" type="number" placeholder="Valor das Pe√ßas">
        <select id="sOleo">
            <option value="nao">Troca de √ìleo? N√£o</option>
            <option value="sim">Sim (Lembrar em 90 dias)</option>
        </select>
        <button class="btn-success" onclick="salvarServico()">SALVAR</button>
        <button onclick="zapOrcamento()">ENVIAR OR√áAMENTO WHATSAPP</button>
    </div>

    <div id="sec-contas" class="section">
        <h3>üí∏ Despesas</h3>
        <input id="cDesc" placeholder="Descri√ß√£o">
        <input id="cVal" type="number" placeholder="Valor R$">
        <button class="btn-danger" onclick="salvarConta()">LAN√áAR GASTO</button>
        <div id="lista-contas"></div>
    </div>

    <div id="sec-hist" class="section">
        <input id="busca" placeholder="üîç Buscar hist√≥rico..." onkeyup="render()">
        <div id="lista-hist"></div>
    </div>

    <div id="sec-oleo" class="section"><h3>üõ¢Ô∏è Retorno de √ìleo</h3><div id="lista-oleo"></div></div>

    <div id="sec-estoque" class="section">
        <h3>üì¶ Estoque</h3>
        <input id="eN" placeholder="Pe√ßa">
        <input id="eQ" type="number" placeholder="Qtd">
        <button onclick="addObj('estoque','eN','eQ')">ADD ESTOQUE</button>
        <div id="l-estoque"></div>
    </div>

    <div id="sec-tabela" class="section">
        <h3>üìã Tabela de Pre√ßos</h3>
        <input id="tN" placeholder="Servi√ßo">
        <input id="tV" placeholder="Pre√ßo Sugerido">
        <button onclick="addObj('tabela','tN','tV')">ADD TABELA</button>
        <div id="l-tabela"></div>
    </div>

    <div id="sec-taxa" class="section">
        <h3>üí≥ Calculadora</h3>
        <input id="taxV" type="number" placeholder="Valor L√≠quido">
        <button onclick="calcTaxa()">CALCULAR REPASSE</button>
    </div>

    <div id="sec-agenda" class="section">
        <h3>üìÖ Agenda</h3>
        <input id="aN" placeholder="Cliente/Motivo">
        <input id="aD" type="date">
        <button onclick="addObj('agenda','aN','aD')">AGENDAR</button>
        <div id="l-agenda"></div>
    </div>

    <div id="sec-compras" class="section">
        <h3>üõí Lista de Compras</h3>
        <input id="cpN" placeholder="Item necess√°rio">
        <button onclick="addObj('compras','cpN')">ADD LISTA</button>
        <div id="l-compras"></div>
    </div>

    <div id="sec-check" class="section">
        <h3>üìã Check-list Entrada</h3>
        <input id="chP" placeholder="Placa">
        <textarea id="chD" placeholder="Avarias/Observa√ß√µes"></textarea>
        <button onclick="addObj('check','chP','chD')">SALVAR CHECK</button>
        <div id="l-check"></div>
    </div>

    <div id="sec-ia" class="section">
        <h3>ü§ñ Analista e Backup</h3>
        <div id="ia-res" style="background:#000; color:#00f298; padding:15px; border-radius:10px; font-family:monospace; margin-bottom:10px;">Aguardando...</div>
        <button onclick="analisarIA()">ANALISAR MEU M√äS</button>
        <hr style="opacity:0.1; margin:20px 0">
        <button onclick="gerarBackup()" style="background:#333">GERAR C√ìDIGO DE BACKUP</button>
        <textarea id="txtBack" style="font-size:8px" placeholder="Seu backup aparecer√° aqui"></textarea>
    </div>

</div>

<script>
let db = JSON.parse(localStorage.getItem('lisboa_master')) || {
    servicos:[], despesas:[], estoque:[], tabela:[], agenda:[], compras:[], check:[]
};
let chart;

function login(){
    if(document.getElementById('pass').value === '1234'){
        document.getElementById('loginPage').style.display='none';
        document.getElementById('mainPage').style.display='block';
        render();
    } else { Swal.fire('Erro','Senha incorreta','error'); }
}

function nav(id){
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

function save(){ localStorage.setItem('lisboa_master', JSON.stringify(db)); render(); }

function salvarServico(){
    const s = {
        n: document.getElementById('sNome').value,
        p: document.getElementById('sPlaca').value.toUpperCase(),
        m: parseFloat(document.getElementById('sMao').value) || 0,
        pe: parseFloat(document.getElementById('sPec').value) || 0,
        z: document.getElementById('sCel').value,
        ol: document.getElementById('sOleo').value,
        d: new Date().getTime()
    };
    if(s.m > 0){ db.servicos.unshift(s); save(); Swal.fire('Sucesso','Servi√ßo registrado','success'); }
}

function salvarConta(){
    const v = parseFloat(document.getElementById('cVal').value) || 0;
    if(v > 0){
        db.despesas.unshift({ n: document.getElementById('cDesc').value, v: v, d: new Date().getTime() });
        save();
    }
}

function addObj(t,id1,id2){
    let obj = { n: document.getElementById(id1).value };
    if(id2) obj.v = document.getElementById(id2).value;
    db[t].push(obj);
    document.getElementById(id1).value='';
    if(id2) document.getElementById(id2).value='';
    save();
}

function render(){
    const mes = document.getElementById('filtroMes').value;
    let sF = db.servicos;
    let dF = db.despesas;

    if(mes !== 'all'){
        sF = db.servicos.filter(s => new Date(s.d).getMonth() == mes);
        dF = db.despesas.filter(d => new Date(d.d).getMonth() == mes);
    }

    let tMao = sF.reduce((a,b)=>a+b.m,0);
    let tPec = sF.reduce((a,b)=>a+b.pe,0);
    let tCon = dF.reduce((a,b)=>a+b.v,0);

    document.getElementById('val-lucro').innerText = "R$ " + (tMao - tCon).toFixed(2);
    document.getElementById('val-mao').innerText = "R$ " + tMao.toFixed(2);
    document.getElementById('val-contas').innerText = "R$ " + tCon.toFixed(2);

    // Render Lists (Busca)
    const b = document.getElementById('busca').value.toUpperCase();
    document.getElementById('lista-hist').innerHTML = sF.filter(x=>x.p.includes(b)||x.n.toUpperCase().includes(b)).map(x=>`<div class="list-item"><span>${x.p} - ${x.n}</span><b>R$ ${x.m+x.pe}</b></div>`).join('');
    
    // Render Simples
    const draw = (arr, id) => document.getElementById(id).innerHTML = arr.map(x=>`<div class="list-item"><span>${x.n}</span><b>${x.v||''}</b></div>`).join('');
    draw(db.estoque, 'l-estoque');
    draw(db.tabela, 'l-tabela');
    draw(db.agenda, 'l-agenda');
    draw(db.compras, 'l-compras');
    draw(db.check, 'l-check');

    // Chart
    const ctx = document.getElementById('chartFin').getContext('2d');
    if(chart) chart.destroy();
    chart = new Chart(ctx, {
        type:'doughnut',
        data:{ labels:['Lucro','Contas','Pe√ßas'], datasets:[{data:[tMao-tCon, tCon, tPec], backgroundColor:['#00f298','#ff4b5c','#2a5ee8'], borderWidth:0}] },
        options: { cutout:'70%', plugins:{ legend:{ labels:{color:'#fff'} } } }
    });
}

function analisarIA(){
    let m = db.servicos.length;
    let res = m > 5 ? "Status: Opera√ß√£o est√°vel. Foco em fidelizar clientes de √≥leo." : "Dica: Aumente o volume de servi√ßos para cobrir custos fixos.";
    document.getElementById('ia-res').innerText = "> " + res;
}

function gerarBackup(){ document.getElementById('txtBack').value = btoa(JSON.stringify(db)); }
function calcTaxa(){ let v = parseFloat(document.getElementById('taxV').value); Swal.fire('Resultado', 'Cobre R$ ' + (v/0.88).toFixed(2) + ' para receber o valor l√≠quido.', 'info'); }
function zapOrcamento(){ /* sua l√≥gica original de whatsapp */ }
function gerarPDF(){ const {jsPDF}=window.jspdf; let d=new jsPDF(); d.text("Relatorio Lisboa",10,10); d.save("financeiro.pdf"); }

render();
</script>
</body>
</html>
