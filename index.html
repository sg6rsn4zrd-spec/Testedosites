<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LISBOA PRO MASTER - OFICIAL</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #0a0e17; --card: #1c222d; --primary: #2a5ee8;
            --accent: #00d2ff; --success: #00f298; --danger: #ff4b5c;
            --text: #e1e8f0;
        }
        
        body { 
            margin: 0; font-family: 'Inter', sans-serif; 
            background: var(--bg); color: var(--text); 
            padding-bottom: 80px; overflow-x: hidden;
        }

        /* Cabe√ßalho com sua Logo */
        .header { 
            background: #161b28; padding: 15px; text-align: center; 
            border-bottom: 1px solid rgba(255,255,255,0.1); 
        }
        .header img { max-width: 160px; height: auto; display: block; margin: 0 auto; }

        .container { padding: 15px; max-width: 500px; margin: auto; }

        /* Card de Saldo igual ao da Foto */
        .balance-card {
            background: #1e2a4a; padding: 25px; border-radius: 24px; text-align: center; margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.05);
        }
        .balance-card h2 { margin: 0; font-size: 0.75rem; text-transform: uppercase; opacity:0.8; letter-spacing: 1px; }
        .balance-val { font-size: 3.2rem; font-weight: 800; color: var(--success); margin: 10px 0; }
        
        .sub-balance { display:flex; justify-content:space-between; font-size:10px; font-weight: bold; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; }

        /* Grid de 12 Bot√µes (4 colunas) */
        .menu-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 25px; }
        .menu-item {
            background: rgba(255,255,255,0.05); padding: 15px 2px; border-radius: 16px;
            text-align: center; cursor: pointer; transition: 0.2s; border: 1px solid rgba(255,255,255,0.02);
            position: relative;
        }
        .menu-item:active { background: var(--primary); transform: scale(0.92); }
        .menu-item i { font-size: 1.4rem; color: var(--accent); margin-bottom: 6px; display:block; }
        .menu-item span { font-size: 0.52rem; font-weight:800; text-transform: uppercase; display: block; color: #fff; }

        /* Estilo das Se√ß√µes */
        .section { display:none; background: var(--card); padding: 20px; border-radius:24px; animation: slideIn 0.3s ease; border: 1px solid rgba(255,255,255,0.05); }
        .active { display:block; }
        @keyframes slideIn { from { opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

        input, select, textarea {
            background:#0f141e; border:1px solid #2d364a; color:white;
            padding:14px; border-radius:12px; width:100%; box-sizing:border-box; margin:8px 0; font-size: 14px;
        }
        button {
            background:var(--primary); color:white; padding:16px; border-radius:14px;
            border:none; font-weight:800; width:100%; cursor:pointer; margin-top:10px; text-transform: uppercase; letter-spacing: 1px;
        }
        .btn-success { background: var(--success); color: #0a0e17; }
        .btn-danger { background: var(--danger); }

        .list-item {
            background: rgba(255,255,255,0.03); padding:15px; border-radius:16px;
            margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;
            border-left:4px solid var(--primary); font-size: 14px;
        }
        .badge { background: var(--danger); color:white; border-radius:50px; padding:2px 8px; font-size:9px; position:absolute; top:-5px; right:-5px; font-weight: bold; }
        
        .ia-box { background:#000; border:1px solid var(--success); padding:15px; border-radius:12px; font-family:monospace; color:var(--success); font-size:12px; line-height: 1.5; }
    </style>
</head>
<body>

<div class="header">
    <img src="B1BCC237-7C89-4142-8131-6DA05C2A2C61 2.png" alt="Lisboa Pro Master Logo">
</div>

<div id="loginPage" class="container">
    <div class="balance-card">
        <i class="fas fa-lock" style="font-size:2rem; color:var(--accent); margin-bottom:10px"></i>
        <h3>ACESSO PRIVADO</h3>
        <input id="pass" type="password" placeholder="Sua Senha">
        <button onclick="login()">ENTRAR NO SISTEMA</button>
    </div>
</div>

<div id="mainPage" class="container" style="display:none">
    
    <select id="filtroMes" onchange="render()" style="margin-bottom: 10px; background: transparent; border: none; color: var(--accent); font-weight: bold; width: auto;">
        <option value="all">üìä TOTAL GERAL</option>
        <option value="0">Janeiro</option><option value="1">Fevereiro</option>
        <option value="2">Mar√ßo</option><option value="3">Abril</option>
        <option value="4">Maio</option><option value="5">Junho</option>
        <option value="6">Julho</option><option value="7">Agosto</option>
        <option value="8">Setembro</option><option value="9">Outubro</option>
        <option value="10">Novembro</option><option value="11">Dezembro</option>
    </select>

    <div class="balance-card">
        <h2>SALDO REAL (LUCRO LIMPO)</h2>
        <div class="balance-val" id="val-lucro">R$ 0,00</div>
        <div class="sub-balance">
            <span>M√£o de Obra: <span id="val-mao" style="color:var(--accent)">R$ 0,00</span></span>
            <span>Contas: <span id="val-contas" style="color:var(--danger)">R$ 0,00</span></span>
            <span>Pe√ßas: <span id="val-pecas" style="color:var(--primary)">R$ 0,00</span></span>
        </div>
    </div>

    <div class="menu-grid">
        <div class="menu-item" onclick="nav('sec-dash')"><i class="fas fa-chart-line"></i><span>Dash</span></div>
        <div class="menu-item" onclick="nav('sec-serv')"><i class="fas fa-plus"></i><span>Novo</span></div>
        <div class="menu-item" onclick="nav('sec-contas')"><i class="fas fa-receipt"></i><span>Contas</span></div>
        <div class="menu-item" onclick="nav('sec-hist')"><i class="fas fa-search"></i><span>Busca</span></div>
        
        <div class="menu-item" onclick="nav('sec-oleo')">
            <i class="fas fa-oil-can"></i><span>√ìleo</span>
            <span id="notif-oleo" class="badge" style="display:none">0</span>
        </div>
        <div class="menu-item" onclick="nav('sec-estoque')"><i class="fas fa-box"></i><span>Estoque</span></div>
        <div class="menu-item" onclick="nav('sec-tabela')"><i class="fas fa-tags"></i><span>Tabela</span></div>
        <div class="menu-item" onclick="nav('sec-taxa')"><i class="fas fa-credit-card"></i><span>Taxas</span></div>
        
        <div class="menu-item" onclick="nav('sec-agenda')"><i class="fas fa-calendar-alt"></i><span>Agenda</span></div>
        <div class="menu-item" onclick="nav('sec-compras')"><i class="fas fa-shopping-cart"></i><span>Compras</span></div>
        <div class="menu-item" onclick="nav('sec-check')"><i class="fas fa-clipboard-list"></i><span>Check</span></div>
        <div class="menu-item" onclick="nav('sec-ia')"><i class="fas fa-robot"></i><span>I.A</span></div>
    </div>

    <div id="sec-dash" class="section active">
        <h3 style="margin-top:0">üìä Resumo Financeiro</h3>
        <canvas id="chartFin" height="250"></canvas>
        <div style="margin-top:20px">
            <input id="metaLucro" type="number" placeholder="Meta de Lucro R$">
            <button class="btn-success" onclick="gerarPDF()">BAIXAR RELAT√ìRIO PDF</button>
            <button class="btn-danger" onclick="confirmReset()">ZERAR DADOS DO SISTEMA</button>
        </div>
    </div>

    <div id="sec-serv" class="section">
        <h3>üîß Cadastrar Servi√ßo</h3>
        <input id="sNome" placeholder="Nome do Cliente">
        <input id="sPlaca" placeholder="Placa do Ve√≠culo">
        <input id="sCel" placeholder="WhatsApp (ex: 5511999999999)">
        <input id="sMao" type="number" placeholder="Valor M√£o de Obra R$">
        <input id="sPec" type="number" placeholder="Valor das Pe√ßas R$">
        <select id="sOleo">
            <option value="nao">Troca de √ìleo? N√£o</option>
            <option value="sim">Sim (Lembrar em 90 dias)</option>
        </select>
        <button class="btn-success" onclick="salvarServico()">SALVAR SERVI√áO</button>
        <button onclick="zapOrcamento()">ENVIAR OR√áAMENTO WHATSAPP</button>
    </div>

    <div id="sec-contas" class="section">
        <h3>üí∏ Lan√ßar Despesa</h3>
        <input id="cDesc" placeholder="Ex: Aluguel, Luz, Pe√ßas">
        <input id="cVal" type="number" placeholder="Valor R$">
        <button class="btn-danger" onclick="salvarConta()">PAGAR AGORA</button>
        <div id="lista-contas" style="margin-top: 20px;"></div>
    </div>

    <div id="sec-hist" class="section">
        <h3>üîç Hist√≥rico e Busca</h3>
        <input id="busca" placeholder="Filtrar por nome ou placa..." onkeyup="render()">
        <div id="lista-hist"></div>
    </div>

    <div id="sec-oleo" class="section"><h3>üõ¢Ô∏è Vencimentos de √ìleo</h3><div id="lista-oleo"></div></div>

    <div id="sec-estoque" class="section">
        <h3>üì¶ Controle de Estoque</h3>
        <input id="eN" placeholder="Nome da Pe√ßa">
        <input id="eQ" type="number" placeholder="Quantidade">
        <button onclick="addObj('estoque','eN','eQ')">ADICIONAR</button>
        <div id="l-estoque"></div>
    </div>

    <div id="sec-tabela" class="section">
        <h3>üìã Tabela de Pre√ßos Sugeridos</h3>
        <input id="tN" placeholder="Nome do Servi√ßo">
        <input id="tV" placeholder="Valor M√©dio">
        <button onclick="addObj('tabela','tN','tV')">ADICIONAR</button>
        <div id="l-tabela"></div>
    </div>

    <div id="sec-taxa" class="section">
        <h3>üí≥ Calculadora de Repasse (Taxas)</h3>
        <input id="taxV" type="number" placeholder="Valor que deseja receber limpo">
        <button onclick="calcTaxa()">CALCULAR PRE√áO FINAL</button>
    </div>

    <div id="sec-agenda" class="section">
        <h3>üìÖ Agenda de Retornos</h3>
        <input id="aN" placeholder="Cliente / Motivo">
        <input id="aD" type="date">
        <button onclick="addObj('agenda','aN','aD')">AGENDAR</button>
        <div id="l-agenda"></div>
    </div>

    <div id="sec-compras" class="section">
        <h3>üõí Lista de Compras</h3>
        <input id="cpN" placeholder="O que precisa comprar?">
        <button onclick="addObj('compras','cpN')">ADD NA LISTA</button>
        <div id="l-compras"></div>
    </div>

    <div id="sec-check" class="section">
        <h3>üìã Check-list de Entrada</h3>
        <input id="chP" placeholder="Placa do Ve√≠culo">
        <textarea id="chD" placeholder="Avarias, riscos, n√≠vel de combust√≠vel..."></textarea>
        <button onclick="addObj('check','chP','chD')">SALVAR CHECK-LIST</button>
        <div id="l-check"></div>
    </div>

    <div id="sec-ia" class="section">
        <h3>ü§ñ Intelig√™ncia e Backup</h3>
        <div id="ia-res" class="ia-box">Pronto para analisar seu financeiro...</div>
        <button onclick="analisarIA()">GERAR DIAGN√ìSTICO</button>
        <hr style="opacity:0.1; margin: 20px 0;">
        <button onclick="gerarBackup()" style="background:#333">C√ìDIGO DE BACKUP (SALVAR)</button>
        <textarea id="txtBack" style="font-size:8px" placeholder="Seu c√≥digo de seguran√ßa aparecer√° aqui"></textarea>
    </div>

</div>

<script>
// BANCO DE DADOS LOCAL
let db = JSON.parse(localStorage.getItem('lisboa_master')) || {
    servicos:[], despesas:[], estoque:[], tabela:[], agenda:[], compras:[], check:[]
};
let chart;

function login(){
    if(document.getElementById('pass').value === '1234'){
        document.getElementById('loginPage').style.display='none';
        document.getElementById('mainPage').style.display='block';
        render();
    } else { Swal.fire('Erro','Senha incorreta','error'); }
}

function nav(id){
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    window.scrollTo(0,0);
}

function salvarServico(){
    const s = {
        n: document.getElementById('sNome').value,
        p: document.getElementById('sPlaca').value.toUpperCase(),
        m: parseFloat(document.getElementById('sMao').value) || 0,
        pe: parseFloat(document.getElementById('sPec').value) || 0,
        z: document.getElementById('sCel').value,
        ol: document.getElementById('sOleo').value,
        d: new Date().getTime()
    };
    if(s.n && s.m > 0){ db.servicos.unshift(s); save(); Swal.fire('Sucesso','Servi√ßo registrado!','success'); }
}

function salvarConta(){
    const v = parseFloat(document.getElementById('cVal').value) || 0;
    if(v > 0){
        db.despesas.unshift({ n: document.getElementById('cDesc').value, v: v, d: new Date().getTime() });
        save();
    }
}

function render(){
    const mes = document.getElementById('filtroMes').value;
    let sF = db.servicos;
    let dF = db.despesas;

    if(mes !== 'all'){
        sF = db.servicos.filter(s => new Date(s.d).getMonth() == mes);
        dF = db.despesas.filter(d => new Date(d.d).getMonth() == mes);
    }

    let mao = sF.reduce((a,b)=>a+b.m, 0);
    let pecas = sF.reduce((a,b)=>a+b.pe, 0);
    let contas = dF.reduce((a,b)=>a+b.v, 0);

    document.getElementById('val-lucro').innerText = "R$ " + (mao - contas).toFixed(2);
    document.getElementById('val-mao').innerText = "R$ " + mao.toFixed(2);
    document.getElementById('val-contas').innerText = "R$ " + contas.toFixed(2);
    document.getElementById('val-pecas').innerText = "R$ " + pecas.toFixed(2);

    // Listas
    const busca = document.getElementById('busca').value.toUpperCase();
    document.getElementById('lista-hist').innerHTML = sF.filter(s => s.p.includes(busca) || s.n.toUpperCase().includes(busca))
        .map(s => `<div class="list-item"><span>${s.p} - ${s.n}</span><b>R$ ${s.m+s.pe}</b></div>`).join('');

    // √ìleo Notifica√ß√£o
    let hoje = new Date().getTime();
    let vCount = 0;
    let oHtml = "";
    db.servicos.forEach(s => {
        if(s.ol === 'sim'){
            let dias = Math.floor((hoje - s.d)/86400000);
            if(dias >= 90){
                vCount++;
                oHtml += `<div class="list-item" style="border-left: 4px solid red"><span>${s.p} - ${s.n}</span><i class="fab fa-whatsapp" style="color:green" onclick="window.open('https://wa.me/${s.z}?text=Ol√°! Notamos que faz 90 dias da sua √∫ltima troca de √≥leo. Vamos agendar?')"></i></div>`;
            }
        }
    });
    document.getElementById('notif-oleo').innerText = vCount;
    document.getElementById('notif-oleo').style.display = vCount > 0 ? 'block' : 'none';
    document.getElementById('lista-oleo').innerHTML = oHtml || "Nenhuma troca pendente.";

    // Render Geral
    const draw = (arr, id) => document.getElementById(id).innerHTML = arr.map(x=>`<div class="list-item"><span>${x.n}</span><b>${x.v||''}</b></div>`).join('');
    draw(db.estoque, 'l-estoque');
    draw(db.tabela, 'l-tabela');
    draw(db.agenda, 'l-agenda');
    draw(db.compras, 'l-compras');
    draw(db.check, 'l-check');
    draw(dF, 'lista-contas');

    // Gr√°fico
    const ctx = document.getElementById('chartFin').getContext('2d');
    if(chart) chart.destroy();
    chart = new Chart(ctx, {
        type:'doughnut',
        data:{ labels:['Lucro','Contas','Pe√ßas'], datasets:[{data:[mao-contas, contas, pecas], backgroundColor:['#00f298','#ff4b5c','#2a5ee8'], borderWidth:0}] },
        options: { cutout:'75%', plugins:{ legend:{ position: 'bottom', labels:{color:'#fff', font:{size:10}} } } }
    });
}

function save(){ localStorage.setItem('lisboa_master', JSON.stringify(db)); render(); }

function addObj(t,id1,id2){
    let o={n:document.getElementById(id1).value}; 
    if(id2) o.v=document.getElementById(id2).value; 
    db[t].unshift(o); 
    document.getElementById(id1).value=''; 
    if(id2) document.getElementById(id2).value='';
    save();
}

function calcTaxa(){
    let v = parseFloat(document.getElementById('taxV').value);
    Swal.fire('Resultado', `Para sobrar R$ ${v} livre, voc√™ deve cobrar R$ ${(v/0.88).toFixed(2)} (Considerando 12% de taxa).`, 'info');
}

function zapOrcamento(){
    let m = document.getElementById('sMao').value;
    let p = document.getElementById('sPec').value;
    let cel = document.getElementById('sCel').value;
    let total = parseFloat(m) + parseFloat(p);
    window.open(`https://wa.me/${cel}?text=OR√áAMENTO LISBOA MASTER:%0A%0AM√£o de Obra: R$ ${m}%0APe√ßas: R$ ${p}%0A---%0ATOTAL: R$ ${total.toFixed(2)}`);
}

function analisarIA(){
    let l = parseFloat(document.getElementById('val-lucro').innerText.replace('R$ ',''));
    let msg = l > 0 ? "O lucro est√° positivo. Mantenha o controle de gastos fixos." : "Aten√ß√£o: Suas despesas est√£o maiores que os ganhos de m√£o de obra!";
    document.getElementById('ia-res').innerText = "> " + msg;
}

function gerarPDF(){ 
    const {jsPDF}=window.jspdf; 
    let d=new jsPDF(); 
    d.text("RELAT√ìRIO LISBOA PRO MASTER",10,10);
    d.text("Total M√£o de Obra: " + document.getElementById('val-mao').innerText, 10, 20);
    d.text("Total Despesas: " + document.getElementById('val-contas').innerText, 10, 30);
    d.save("Financeiro_Oficina.pdf"); 
}

function gerarBackup(){ document.getElementById('txtBack').value = btoa(JSON.stringify(db)); }

function confirmReset(){
    Swal.fire({title:'Zerar?', text:'Deseja apagar todos os registros?', icon:'warning', showCancelButton:true}).then(r=>{if(r.isConfirmed){db={servicos:[],despesas:[],estoque:[],tabela:[],agenda:[],compras:[],check:[]}; save();}});
}

render();
</script>
</body>
</html>
