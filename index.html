<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LISBOA PRO MASTER - OFICIAL</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #0a0e17; --card: #1c222d; --primary: #2a5ee8;
            --accent: #00d2ff; --success: #00f298; --danger: #ff4b5c;
            --text: #e1e8f0;
        }
        
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding-bottom: 80px; }

        /* Cabe√ßalho com sua Logo */
        .header { background: #161b28; padding: 15px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .header img { max-width: 150px; height: auto; display: block; margin: 0 auto; }

        .container { padding: 15px; max-width: 500px; margin: auto; }

        /* Card de Saldo da Foto */
        .balance-card {
            background: #1e2a4a; padding: 25px; border-radius: 24px; text-align: center; margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.05);
        }
        .balance-card h2 { margin: 0; font-size: 0.75rem; text-transform: uppercase; opacity:0.8; letter-spacing: 1px; }
        .balance-val { font-size: 3rem; font-weight: 800; color: var(--success); margin: 10px 0; }
        
        .sub-balance { display:flex; justify-content:space-between; font-size:10px; font-weight: bold; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }

        /* Menu de 12 Bot√µes (4 colunas) */
        .menu-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 25px; }
        .menu-item {
            background: rgba(255,255,255,0.05); padding: 15px 2px; border-radius: 16px;
            text-align: center; cursor: pointer; transition: 0.2s; border: 1px solid rgba(255,255,255,0.02);
            position: relative;
        }
        .menu-item:active { background: var(--primary); transform: scale(0.92); }
        .menu-item i { font-size: 1.4rem; color: var(--accent); margin-bottom: 6px; display:block; }
        .menu-item span { font-size: 0.52rem; font-weight:800; text-transform: uppercase; display: block; color: #fff; }

        /* Se√ß√µes */
        .section { display:none; background: var(--card); padding: 20px; border-radius:24px; animation: slideIn 0.3s ease; border: 1px solid rgba(255,255,255,0.05); }
        .active { display:block; }
        @keyframes slideIn { from { opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

        input, select, textarea {
            background:#0f141e; border:1px solid #2d364a; color:white;
            padding:14px; border-radius:12px; width:100%; box-sizing:border-box; margin:8px 0;
        }
        button {
            background:var(--primary); color:white; padding:16px; border-radius:14px;
            border:none; font-weight:800; width:100%; cursor:pointer; margin-top:10px; text-transform: uppercase;
        }
        .btn-success { background: var(--success); color: #0a0e17; }
        .btn-danger { background: var(--danger); }

        .list-item {
            background: rgba(255,255,255,0.03); padding:15px; border-radius:16px;
            margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;
            border-left:4px solid var(--primary); font-size: 14px;
        }
        .badge { background: var(--danger); color:white; border-radius:50px; padding:2px 8px; font-size:9px; position:absolute; top:-5px; right:-5px; font-weight: bold; }
    </style>
</head>
<body>

<div class="header">
    <img src="B1BCC237-7C89-4142-8131-6DA05C2A2C61 2.png" alt="Lisboa Pro Master">
</div>

<div class="container">
    <div class="balance-card">
        <h2>SALDO REAL (LUCRO LIMPO)</h2>
        <div class="balance-val" id="val-lucro">R$ 0,00</div>
        <div class="sub-balance">
            <span>M√£o de Obra: <span id="val-mao" style="color:var(--accent)">R$ 0,00</span></span>
            <span>Contas: <span id="val-contas" style="color:var(--danger)">R$ 0,00</span></span>
            <span>Pe√ßas: <span id="val-pecas" style="color:var(--primary)">R$ 0,00</span></span>
        </div>
    </div>

    <div class="menu-grid">
        <div class="menu-item" onclick="nav('sec-dash')"><i class="fas fa-chart-line"></i><span>Dash</span></div>
        <div class="menu-item" onclick="nav('sec-serv')"><i class="fas fa-plus"></i><span>Novo</span></div>
        <div class="menu-item" onclick="nav('sec-contas')"><i class="fas fa-receipt"></i><span>Contas</span></div>
        <div class="menu-item" onclick="nav('sec-hist')"><i class="fas fa-search"></i><span>Busca</span></div>
        
        <div class="menu-item" onclick="nav('sec-oleo')">
            <i class="fas fa-oil-can"></i><span>√ìleo</span>
            <span id="notif-oleo" class="badge" style="display:none">0</span>
        </div>
        <div class="menu-item" onclick="nav('sec-estoque')"><i class="fas fa-box"></i><span>Estoque</span></div>
        <div class="menu-item" onclick="nav('sec-tabela')"><i class="fas fa-tags"></i><span>Tabela</span></div>
        <div class="menu-item" onclick="nav('sec-taxa')"><i class="fas fa-credit-card"></i><span>Taxas</span></div>
        
        <div class="menu-item" onclick="nav('sec-agenda')"><i class="fas fa-calendar-alt"></i><span>Agenda</span></div>
        <div class="menu-item" onclick="nav('sec-compras')"><i class="fas fa-shopping-cart"></i><span>Compras</span></div>
        <div class="menu-item" onclick="nav('sec-check')"><i class="fas fa-clipboard-list"></i><span>Check</span></div>
        <div class="menu-item" onclick="nav('sec-ia')"><i class="fas fa-robot"></i><span>I.A</span></div>
    </div>

    <div id="sec-dash" class="section active">
        <h3>üìä Dashboard</h3>
        <canvas id="chartFin"></canvas>
        <button class="btn-success" onclick="exportarPDF()">Exportar PDF</button>
    </div>

    <div id="sec-serv" class="section">
        <h3>üîß Novo Servi√ßo</h3>
        <input id="sNome" placeholder="Cliente">
        <input id="sPlaca" placeholder="Placa">
        <input id="sMao" type="number" placeholder="M√£o de Obra R$">
        <input id="sPec" type="number" placeholder="Pe√ßas R$">
        <input id="sCel" placeholder="WhatsApp">
        <select id="sOleo"><option value="nao">Troca √ìleo: N√£o</option><option value="sim">Troca √ìleo: Sim</option></select>
        <button class="btn-success" onclick="salvarServico()">Salvar</button>
    </div>

    <div id="sec-contas" class="section">
        <h3>üí∏ Despesas</h3>
        <input id="cDesc" placeholder="Descri√ß√£o">
        <input id="cVal" type="number" placeholder="Valor R$">
        <button class="btn-danger" onclick="salvarConta()">Lan√ßar</button>
        <div id="l-contas"></div>
    </div>

    <div id="sec-hist" class="section">
        <h3>üîç Hist√≥rico</h3>
        <input id="busca" placeholder="Buscar..." onkeyup="render()">
        <div id="l-hist"></div>
    </div>

    <div id="sec-oleo" class="section"><h3>üõ¢Ô∏è Retorno de √ìleo</h3><div id="l-oleo"></div></div>

    <div id="sec-estoque" class="section">
        <h3>üì¶ Estoque</h3>
        <input id="eN" placeholder="Pe√ßa"><input id="eQ" type="number" placeholder="Qtd">
        <button onclick="addObj('estoque','eN','eQ')">Adicionar</button>
        <div id="l-estoque"></div>
    </div>

    <div id="sec-tabela" class="section">
        <h3>üìã Tabela de Pre√ßos</h3>
        <input id="tN" placeholder="Servi√ßo"><input id="tV" placeholder="Valor">
        <button onclick="addObj('tabela','tN','tV')">Adicionar</button>
        <div id="l-tabela"></div>
    </div>

    <div id="sec-taxa" class="section">
        <h3>üí≥ Calculadora Taxas</h3>
        <input id="taxV" type="number" placeholder="Valor L√≠quido">
        <button onclick="calcTaxa()">Calcular</button>
    </div>

    <div id="sec-agenda" class="section">
        <h3>üìÖ Agenda</h3>
        <input id="aN" placeholder="Cliente"><input id="aD" type="date">
        <button onclick="addObj('agenda','aN','aD')">Agendar</button>
        <div id="l-agenda"></div>
    </div>

    <div id="sec-compras" class="section">
        <h3>üõí Lista de Compras</h3>
        <input id="cpN" placeholder="Item">
        <button onclick="addObj('compras','cpN')">Add Lista</button>
        <div id="l-compras"></div>
    </div>

    <div id="sec-check" class="section">
        <h3>üìã Check-list</h3>
        <input id="chP" placeholder="Placa"><textarea id="chD" placeholder="Observa√ß√µes"></textarea>
        <button onclick="addObj('check','chP','chD')">Salvar Check</button>
        <div id="l-check"></div>
    </div>

    <div id="sec-ia" class="section">
        <h3>ü§ñ I.A e Backup</h3>
        <div id="ia-res" style="background:#000; color:#00f298; padding:15px; border-radius:12px; font-family:monospace">Aguardando an√°lise...</div>
        <button onclick="gerarBackup()">Gerar C√≥digo de Backup</button>
        <textarea id="txtBack" style="font-size:8px; margin-top:10px"></textarea>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('lisboa_master')) || { servicos:[], despesas:[], estoque:[], tabela:[], agenda:[], compras:[], check:[] };
    let chart;

    function nav(id){
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0,0);
    }

    function save(){ localStorage.setItem('lisboa_master', JSON.stringify(db)); render(); }

    function salvarServico(){
        let s = { n: document.getElementById('sNome').value, p: document.getElementById('sPlaca').value.toUpperCase(), m: parseFloat(document.getElementById('sMao').value)||0, pe: parseFloat(document.getElementById('sPec').value)||0, z: document.getElementById('sCel').value, ol: document.getElementById('sOleo').value, d: new Date().getTime() };
        if(s.m > 0){ db.servicos.unshift(s); save(); Swal.fire('Salvo!','','success'); }
    }

    function salvarConta(){
        let v = parseFloat(document.getElementById('cVal').value)||0;
        if(v > 0){ db.despesas.unshift({n: document.getElementById('cDesc').value, v:v, d: new Date().getTime()}); save(); }
    }

    function render(){
        let mao = db.servicos.reduce((a,b)=>a+b.m,0);
        let pecas = db.servicos.reduce((a,b)=>a+b.pe,0);
        let contas = db.despesas.reduce((a,b)=>a+b.v,0);

        document.getElementById('val-lucro').innerText = "R$ " + (mao - contas).toFixed(2);
        document.getElementById('val-mao').innerText = "R$ " + mao.toFixed(2);
        document.getElementById('val-contas').innerText = "R$ " + contas.toFixed(2);
        document.getElementById('val-pecas').innerText = "R$ " + pecas.toFixed(2);

        const b = document.getElementById('busca').value.toUpperCase();
        document.getElementById('l-hist').innerHTML = db.servicos.filter(s => s.p.includes(b) || s.n.toUpperCase().includes(b)).map(s => `<div class="list-item"><span>${s.p} - ${s.n}</span><b>R$ ${s.m+s.pe}</b></div>`).join('');

        const draw = (arr, id) => document.getElementById(id).innerHTML = arr.map(x => `<div class="list-item"><span>${x.n}</span><b>${x.v||''}</b></div>`).join('');
        draw(db.estoque, 'l-estoque'); draw(db.tabela, 'l-tabela'); draw(db.agenda, 'l-agenda'); draw(db.compras, 'l-compras'); draw(db.check, 'l-check'); draw(db.despesas, 'l-contas');

        const ctx = document.getElementById('chartFin').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, { type:'doughnut', data:{ labels:['Lucro','Contas','Pe√ßas'], datasets:[{data:[mao-contas, contas, pecas], backgroundColor:['#00f298','#ff4b5c','#2a5ee8'], borderWidth:0}] }, options:{ cutout:'75%', plugins:{legend:{position:'bottom',labels:{color:'#fff'}}}}});
    }

    function addObj(t,i1,i2){ let o={n:document.getElementById(i1).value}; if(i2) o.v=document.getElementById(i2).value; db[t].unshift(o); save(); }
    function calcTaxa(){ let v = parseFloat(document.getElementById('taxV').value); Swal.fire('Cobrar:', 'R$ ' + (v/0.88).toFixed(2), 'info'); }
    function gerarBackup(){ document.getElementById('txtBack').value = btoa(JSON.stringify(db)); }
    
    render();
</script>
</body>
</html>
