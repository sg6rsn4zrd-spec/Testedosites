<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LISBOA PRO MASTER - COMPLETO</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #0a0e17; --card: #1c222d; --primary: #2a5ee8;
            --accent: #00d2ff; --success: #00f298; --danger: #ff4b5c;
            --text: #e1e8f0;
        }
        
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding-bottom: 80px; }

        /* Cabe√ßalho com sua LOGO */
        .header { background: #161b28; padding: 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .header img { max-width: 150px; height: auto; display: block; margin: 0 auto; }

        .container { padding: 15px; max-width: 500px; margin: auto; }

        /* Card de Saldo Premium */
        .balance-card {
            background: #1e2a4a; padding: 25px; border-radius: 24px; text-align: center; margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.05);
        }
        .balance-card h2 { margin: 0; font-size: 0.75rem; text-transform: uppercase; opacity:0.8; letter-spacing: 1px; }
        .balance-val { font-size: 3rem; font-weight: 800; color: var(--success); margin: 10px 0; }
        
        .sub-balance { display:flex; justify-content:space-between; font-size:10px; font-weight: bold; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); }

        /* Grid de 12 Bot√µes (4 colunas) */
        .menu-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 25px; }
        .menu-item {
            background: rgba(255,255,255,0.05); padding: 18px 2px; border-radius: 16px;
            text-align: center; cursor: pointer; transition: 0.2s; border: 1px solid rgba(255,255,255,0.02);
            position: relative;
        }
        .menu-item:active { background: var(--primary); transform: scale(0.92); }
        .menu-item i { font-size: 1.4rem; color: var(--accent); margin-bottom: 6px; display:block; }
        .menu-item span { font-size: 0.52rem; font-weight:800; text-transform: uppercase; display: block; color: #fff; }

        /* Se√ß√µes Estilizadas */
        .section { display:none; background: var(--card); padding: 20px; border-radius:24px; animation: slideIn 0.3s ease; border: 1px solid rgba(255,255,255,0.05); }
        .active { display:block; }
        @keyframes slideIn { from { opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

        input, select, textarea {
            background:#0f141e; border:1px solid #2d364a; color:white;
            padding:14px; border-radius:12px; width:100%; box-sizing:border-box; margin:8px 0;
        }
        button {
            background:var(--primary); color:white; padding:16px; border-radius:14px;
            border:none; font-weight:800; width:100%; cursor:pointer; margin-top:10px; text-transform: uppercase;
        }
        .btn-success { background: var(--success); color: #0a0e17; }
        .btn-danger { background: var(--danger); }

        .list-item {
            background: rgba(255,255,255,0.03); padding:15px; border-radius:16px;
            margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;
            border-left:4px solid var(--primary); font-size: 14px;
        }
        .badge { background: var(--danger); color:white; border-radius:50px; padding:2px 8px; font-size:9px; position:absolute; top:-5px; right:-5px; font-weight: bold; }
    </style>
</head>
<body>

<div class="header">
    <img src="B1BCC237-7C89-4142-8131-6DA05C2A2C61 2.png" alt="Lisboa Logo">
</div>

<div class="container">
    <div class="balance-card">
        <h2>SALDO REAL (LUCRO LIMPO)</h2>
        <div class="balance-val" id="val-lucro">R$ 0,00</div>
        <div class="sub-balance">
            <span>M√£o de Obra: <span id="val-mao" style="color:var(--accent)">R$ 0,00</span></span>
            <span>Contas: <span id="val-contas" style="color:var(--danger)">R$ 0,00</span></span>
            <span>Pe√ßas: <span id="val-pecas" style="color:var(--primary)">R$ 0,00</span></span>
        </div>
    </div>

    <div class="menu-grid">
        <div class="menu-item" onclick="nav('sec-dash')"><i class="fas fa-chart-line"></i><span>Dash</span></div>
        <div class="menu-item" onclick="nav('sec-serv')"><i class="fas fa-plus-circle"></i><span>Novo</span></div>
        <div class="menu-item" onclick="nav('sec-contas')"><i class="fas fa-file-invoice-dollar"></i><span>Contas</span></div>
        <div class="menu-item" onclick="nav('sec-hist')"><i class="fas fa-search"></i><span>Busca</span></div>
        
        <div class="menu-item" onclick="nav('sec-oleo')">
            <i class="fas fa-oil-can"></i><span>√ìleo</span>
            <span id="notif-oleo" class="badge" style="display:none">0</span>
        </div>
        <div class="menu-item" onclick="nav('sec-estoque')"><i class="fas fa-box-open"></i><span>Estoque</span></div>
        <div class="menu-item" onclick="nav('sec-tabela')"><i class="fas fa-list-ol"></i><span>Tabela</span></div>
        <div class="menu-item" onclick="nav('sec-taxa')"><i class="fas fa-credit-card"></i><span>Taxas</span></div>
        
        <div class="menu-item" onclick="nav('sec-agenda')"><i class="fas fa-calendar-check"></i><span>Agenda</span></div>
        <div class="menu-item" onclick="nav('sec-compras')"><i class="fas fa-shopping-basket"></i><span>Compras</span></div>
        <div class="menu-item" onclick="nav('sec-check')"><i class="fas fa-tasks"></i><span>Check</span></div>
        <div class="menu-item" onclick="nav('sec-ia')"><i class="fas fa-brain"></i><span>I.A</span></div>
    </div>

    <div id="sec-dash" class="section active">
        <h3>üìä Gr√°fico e Metas</h3>
        <canvas id="chartFin"></canvas>
        <button class="btn-success" onclick="alert('Gerando PDF...')">Exportar Relat√≥rio</button>
    </div>

    <div id="sec-serv" class="section">
        <h3>üîß Novo Servi√ßo</h3>
        <input id="sNome" placeholder="Nome do Cliente">
        <input id="sPlaca" placeholder="Placa">
        <input id="sMao" type="number" placeholder="Sua M√£o de Obra">
        <input id="sPec" type="number" placeholder="Valor das Pe√ßas">
        <input id="sCel" placeholder="WhatsApp do Cliente">
        <select id="sOleo"><option value="nao">Troca de √ìleo? N√£o</option><option value="sim">Sim (90 dias)</option></select>
        <button class="btn-success" onclick="salvarServico()">Salvar Servi√ßo</button>
    </div>

    <div id="sec-contas" class="section">
        <h3>üí∏ Lan√ßar Despesa</h3>
        <input id="cDesc" placeholder="Ex: Aluguel, Luz, Compras">
        <input id="cVal" type="number" placeholder="Valor R$">
        <button class="btn-danger" onclick="salvarConta()">Lan√ßar Gasto</button>
        <div id="l-contas" style="margin-top:15px"></div>
    </div>

    <div id="sec-hist" class="section">
        <h3>üîç Hist√≥rico Geral</h3>
        <input id="busca" placeholder="Filtrar por nome ou placa..." onkeyup="render()">
        <div id="l-hist"></div>
    </div>

    <div id="sec-oleo" class="section">
        <h3>üõ¢Ô∏è Vencimento de √ìleo</h3>
        <div id="l-oleo"></div>
    </div>

    <div id="sec-estoque" class="section">
        <h3>üì¶ Controle de Estoque</h3>
        <input id="eN" placeholder="Nome da Pe√ßa">
        <input id="eQ" type="number" placeholder="Quantidade">
        <button onclick="addEstoque()">Adicionar</button>
        <div id="l-estoque"></div>
    </div>

    <div id="sec-tabela" class="section">
        <h3>üìã Tabela de Pre√ßos</h3>
        <input id="tN" placeholder="Servi√ßo/Pe√ßa">
        <input id="tV" placeholder="Valor M√©dio">
        <button onclick="addTabela()">Adicionar √† Lista</button>
        <div id="l-tabela"></div>
    </div>

    <div id="sec-taxa" class="section">
        <h3>üí≥ Repasse de Taxas</h3>
        <input id="taxV" type="number" placeholder="Valor que deseja receber">
        <button onclick="calcTaxa()">Calcular Valor Final</button>
    </div>

    <div id="sec-agenda" class="section">
        <h3>üìÖ Agenda de Retorno</h3>
        <input id="aN" placeholder="Nome/Servi√ßo">
        <input id="aD" type="date">
        <button onclick="addAgenda()">Agendar</button>
        <div id="l-agenda"></div>
    </div>

    <div id="sec-compras" class="section">
        <h3>üõí Lista de Compras</h3>
        <input id="cpN" placeholder="Item necess√°rio">
        <button onclick="addCompras()">Adicionar √† Lista</button>
        <div id="l-compras"></div>
    </div>

    <div id="sec-check" class="section">
        <h3>üìã Check-list Entrada</h3>
        <input id="chP" placeholder="Placa">
        <textarea id="chD" placeholder="Observa√ß√µes e Avarias"></textarea>
        <button onclick="addCheck()">Salvar Check-list</button>
        <div id="l-check"></div>
    </div>

    <div id="sec-ia" class="section">
        <h3>ü§ñ I.A e Backup</h3>
        <div id="ia-res" style="background:#000; color:#00f298; padding:15px; border-radius:12px; font-family:monospace">Pronto para analisar...</div>
        <button onclick="gerarBackup()">Gerar C√≥digo de Backup</button>
        <textarea id="txtBack" style="font-size:8px; margin-top:10px" placeholder="Backup aparecer√° aqui"></textarea>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('lisboa_master')) || { 
        servicos:[], despesas:[], estoque:[], tabela:[], agenda:[], compras:[], check:[] 
    };
    let chart;

    function nav(id){
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0,0);
    }

    function save(){ localStorage.setItem('lisboa_master', JSON.stringify(db)); render(); }

    function salvarServico(){
        let s = {
            n: document.getElementById('sNome').value,
            p: document.getElementById('sPlaca').value.toUpperCase(),
            m: parseFloat(document.getElementById('sMao').value)||0,
            pe: parseFloat(document.getElementById('sPec').value)||0,
            z: document.getElementById('sCel').value,
            ol: document.getElementById('sOleo').value,
            d: new Date().getTime()
        };
        if(s.m > 0){ db.servicos.unshift(s); save(); Swal.fire('Salvo!','Servi√ßo registrado','success'); }
    }

    function salvarConta(){
        let v = parseFloat(document.getElementById('cVal').value)||0;
        if(v > 0){ db.despesas.unshift({n: document.getElementById('cDesc').value, v:v, d: new Date().getTime()}); save(); }
    }

    // Fun√ß√µes Individuais (Para n√£o faltar nada!)
    function addEstoque(){ db.estoque.unshift({n: document.getElementById('eN').value, v: document.getElementById('eQ').value}); save(); }
    function addTabela(){ db.tabela.unshift({n: document.getElementById('tN').value, v: document.getElementById('tV').value}); save(); }
    function addAgenda(){ db.agenda.unshift({n: document.getElementById('aN').value, v: document.getElementById('aD').value}); save(); }
    function addCompras(){ db.compras.unshift({n: document.getElementById('cpN').value}); save(); }
    function addCheck(){ db.check.unshift({n: document.getElementById('chP').value, v: document.getElementById('chD').value}); save(); }

    function render(){
        let mao = db.servicos.reduce((a,b)=>a+b.m, 0);
        let pecas = db.servicos.reduce((a,b)=>a+b.pe, 0);
        let contas = db.despesas.reduce((a,b)=>a+b.v, 0);

        document.getElementById('val-lucro').innerText = "R$ " + (mao - contas).toFixed(2);
        document.getElementById('val-mao').innerText = "R$ " + mao.toFixed(2);
        document.getElementById('val-contas').innerText = "R$ " + contas.toFixed(2);
        document.getElementById('val-pecas').innerText = "R$ " + pecas.toFixed(2);

        const b = document.getElementById('busca').value.toUpperCase();
        document.getElementById('l-hist').innerHTML = db.servicos.filter(s => s.p.includes(b) || s.n.toUpperCase().includes(b)).map(s => `<div class="list-item"><span>${s.p} - ${s.n}</span><b>R$ ${s.m+s.pe}</b></div>`).join('');

        const draw = (arr, id) => document.getElementById(id).innerHTML = arr.map(x => `<div class="list-item"><span>${x.n}</span><b>${x.v||''}</b></div>`).join('');
        draw(db.estoque, 'l-estoque');
        draw(db.tabela, 'l-tabela');
        draw(db.agenda, 'l-agenda');
        draw(db.compras, 'l-compras');
        draw(db.check, 'l-check');
        draw(db.despesas, 'l-contas');

        // Notifica√ß√£o √ìleo
        let hoje = new Date().getTime();
        let vCount = 0;
        let oHtml = "";
        db.servicos.forEach(s => {
            if(s.ol === 'sim' && (hoje - s.d) > 90*86400000){
                vCount++;
                oHtml += `<div class="list-item" style="border-left-color:red"><span>${s.p} - ${s.n}</span><i class="fab fa-whatsapp" onclick="window.open('https://wa.me/${s.z}')"></i></div>`;
            }
        });
        document.getElementById('notif-oleo').innerText = vCount;
        document.getElementById('notif-oleo').style.display = vCount > 0 ? 'block' : 'none';
        document.getElementById('l-oleo').innerHTML = oHtml || "Tudo em dia!";

        const ctx = document.getElementById('chartFin').getContext('2d');
        if(chart) chart.destroy();
        chart = new Chart(ctx, { type:'doughnut', data:{ labels:['Lucro','Contas','Pe√ßas'], datasets:[{data:[mao-contas, contas, pecas], backgroundColor:['#00f298','#ff4b5c','#2a5ee8'], borderWidth:0}] }, options:{ cutout:'75%', plugins:{legend:{position:'bottom',labels:{color:'#fff'}}}}});
    }

    function calcTaxa(){ let v = parseFloat(document.getElementById('taxV').value); Swal.fire('Valor a Cobrar:', 'R$ ' + (v/0.88).toFixed(2), 'info'); }
    function gerarBackup(){ document.getElementById('txtBack').value = btoa(JSON.stringify(db)); }
    
    render();
</script>
</body>
</html>
